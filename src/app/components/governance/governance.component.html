<app-body-bg-changer
  [imgSrc]="'assets/img/governance.jpg'"
></app-body-bg-changer>

<div class="main py-5 px-3">
  <!-- header -->
  <header class="container-medium text-white text-center text-black">
    <h1 class="display-6 fw-bold mb-2">Governance</h1>
    <p class="lead mb-2">
      Anyone holding at least 1 EBOX is eligible to vote for a certain point of
      time that is arbitrarily chosen by the ethbox team for each voting.
    </p>
    <div class="mb-5">
      <small
        >For further understanding, please have a look at our
        <a
          class="text-reset"
          href="https://ethbox.medium.com/ethbox-introducing-governance-540f237cda3e"
          target="_blank"
          >Medium article</a
        >
        on governance.</small
      >
    </div>
  </header>
  <!-- end of header -->

  <div class="container-medium">

    <ng-container
      *ngIf="!(contractServ.isAppReady$ | async); else showAddressAndTime"
    >
      <div class="display-6 fw-bold text-center text-white mb-5">
        Connect to vote
      </div>
    </ng-container>
    <ng-template #showAddressAndTime>
      <!-- address and time -->
      <div
        class="d-flex flex-column flex-md-row justify-content-between text-white mb-3"
      >
        <div class="mb-3 mb-md-0">
          <div class="fs-5">Your address</div>
          <small *ngIf="contractServ.selectedAccount$ | async as selAcc">
            {{ selAcc.slice(0, 8) }}...{{ selAcc.slice(-6) }}
          </small>
        </div>
        <div>
          <div class="fs-5 text-md-end">Datetime</div>
          <small>{{ datetime }}</small>
        </div>
      </div>
      <!-- end of address and time -->
    </ng-template>

    <div class="text-white text-center mb-3">
      <small>Click on an area to expand it</small>
    </div>
    <div class="d-grid gap-3">
      <div class="bg-white rounded-alot" *ngFor="let area of pageData">
        <div class="d-flex flex-wrap align-items-center justify-content-between p-3 position-relative">
          <div class="fs-4 fw-bold">
            {{ area.title }}
            <a href="#{{area._id}}" data-bs-toggle="collapse" class="stretched-link text-reset text-decoration-none">
              <i class="bi bi-chevron-down"></i>
            </a>
          </div>
          <div>{{ area.proposals.length }} proposals</div>
        </div>
        <div class="collapse" [id]="area._id">
          <div class="text-center">
            <small>Click on a voting to expand it</small>
          </div>
          <div class="d-grid gap-3 p-3">
            <div
              class="bg-eboxdark text-white rounded-alot p-3" 
              *ngFor="let proposal of area.proposals"
              [class.bg-completed]="proposal.hasExpired || proposal.hasVoted">
              <div class="position-relative">
                <div class="d-flex align-items-center justify-content-between">
                  <div class="fs-5 fw-bold">
                    Voting #{{ proposal.n }}
                    <a href="#{{proposal._id}}" data-bs-toggle="collapse" class="stretched-link text-reset text-decoration-none">
                      <i class="bi bi-chevron-down"></i>
                    </a>
                    <small *ngIf="proposal.hasExpired">
                      (Expired)
                    </small>
                  </div>
                  <div>{{ proposal.answers.length }} choices</div>
                </div>
                <div>{{ proposal.question }}</div>
              </div>
              <div class="collapse" [id]="proposal._id">
                <div class="my-2 text-center">
                  <small>Pick your choice</small>
                </div>
                <div class="bg-white text-dark rounded-alot p-3">
                  <div class="d-flex flex-wrap justify-content-between gap-2">
                    <div>
                      <div class="fw-bold">Start</div>
                      <div>{{ proposal.startDatetime }}</div>
                    </div>
                    <div>
                      <div class="fw-bold text-sm-end">End</div>
                      <div>{{ proposal.endDatetime }}</div>
                    </div>
                  </div>
                  <app-governance-proposal [proposal]="proposal"></app-governance-proposal>
                </div>
              </div>
            </div>
          </div>
      </div>
      </div>
    </div>
  </div>
</div>